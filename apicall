#!/bin/bash
while true; do
echo "Refreshing OIDC token..."
curl -s -H "Metadata-Flavor: Google" \
http://metadata/computeMetadata/v1/instance/service-accounts/default/identity?audience=https://example.com \
-o /opt/keys/temp-token.json

export GOOGLE_APPLICATION_CREDENTIALS=/opt/keys/temp-token.json
sleep 3000 # refresh every 50 minutes
done
