pCollection
.apply(Window.<KV<String, Mutation>>into(FixedWindows.of(Duration.standardSeconds(10)))
.triggering(Repeatedly.forever(
AfterProcessingTime.pastFirstElementInPane().plusDelayOf(Duration.standardSeconds(5))))
.discardingFiredPanes()
.withAllowedLateness(Duration.ZERO))
.apply(GroupIntoBatches.ofSize(500)) // group records into manageable batches
.apply(SpannerIO.write()
.withInstanceId("instance")
.withDatabaseId("db")
.withMaxNumMutations(1000)
.withBatchSizeBytes(512 * 1024)
.withMaxCumulativeBacklogBytes(20 * 1024 * 1024) // 20MB backlog
.withRetryPolicy(RetryPolicy.exponentialBackoff(5)));
