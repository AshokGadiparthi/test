Got it üëç ‚Äî you want to **keep using the ‚ÄúUser OAuth (personal)‚Äù flow** (i.e., browser redirect ‚Üí Google login ‚Üí back to your app), **not** the service account.

Here‚Äôs exactly how to fix your setup for that flow üëá

---

## ‚úÖ Correct Configuration for **User OAuth (Google SSO)**

### 1Ô∏è‚É£ Google Cloud Console setup

Create credentials of type **OAuth client ID ‚Üí Web Application**

Add:

**Authorized JavaScript origins**

```
http://localhost:4200
http://localhost:8080
```

**Authorized redirect URIs**

```
http://localhost:8080/login/oauth2/code/google
```

> These must match your Spring Boot app URL that handles the login callback.

---

### 2Ô∏è‚É£ Spring Boot `application.yml`

```yaml
spring:
  security:
    oauth2:
      client:
        registration:
          google:
            client-id: YOUR_CLIENT_ID
            client-secret: YOUR_CLIENT_SECRET
            scope:
              - openid
              - email
              - profile
            redirect-uri: "{baseUrl}/login/oauth2/code/google"
        provider:
          google:
            authorization-uri: https://accounts.google.com/o/oauth2/v2/auth
            token-uri: https://oauth2.googleapis.com/token
            user-info-uri: https://www.googleapis.com/oauth2/v3/userinfo
            user-name-attribute: sub
```

---

### 3Ô∏è‚É£ Spring Boot `SecurityConfig.java`

```java
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http
            .authorizeHttpRequests(auth -> auth
                .requestMatchers("/", "/error", "/public/**").permitAll()
                .anyRequest().authenticated()
            )
            .oauth2Login(oauth -> oauth
                .defaultSuccessUrl("http://localhost:4200/home", true)
            )
            .logout(logout -> logout
                .logoutSuccessUrl("http://localhost:4200/")
            );
        return http.build();
    }
}
```

---

### 4Ô∏è‚É£ Login URL (for Angular or direct browser)

Use:

```
http://localhost:8080/oauth2/authorization/google
```

Spring Security will:

1. Redirect the user to **Google login**.
2. Google returns to `/login/oauth2/code/google`.
3. Spring exchanges the code ‚Üí token ‚Üí retrieves profile ‚Üí authenticates the user.

---

### 5Ô∏è‚É£ CORS configuration

```java
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class WebConfig {
    @Bean
    public WebMvcConfigurer corsConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                registry.addMapping("/**")
                        .allowedOrigins("http://localhost:4200")
                        .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                        .allowCredentials(true);
            }
        };
    }
}
```

---

### ‚úÖ Summary of your chosen flow

| Flow Type                 | Uses Browser Redirect? | Requires Client ID/Secret? | Uses JSON Key? | Intended For               |
| ------------------------- | ---------------------- | -------------------------- | -------------- | -------------------------- |
| **User OAuth (personal)** | ‚úÖ Yes                  | ‚úÖ Yes                      | ‚ùå No           | Human sign-in (Google SSO) |

---

If you want, I can show a **small working example** (backend + frontend sequence diagram) showing exactly how `Spring Boot ‚Üî Google ‚Üî Angular` interact during this OAuth login flow. Would you like that?
