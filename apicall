SELECT
*,

-- Normalize CJCM value (works for array or string)
(
SELECT STRING_AGG(v, ', ' ORDER BY v)
FROM UNNEST(
SPLIT(
CASE
WHEN NOT REGEXP_CONTAINS(TO_JSON_STRING(CJCM_Value), r'^\["')
THEN CJCM_Value
ELSE ARRAY_TO_STRING(CJCM_Value, ',')
END
, ',')
) AS v
) AS CJCM_Value_Ordered,

-- Normalize Spanner value
(
SELECT STRING_AGG(v, ', ' ORDER BY v)
FROM UNNEST(
SPLIT(
CASE
WHEN NOT REGEXP_CONTAINS(TO_JSON_STRING(Spanner_Value), r'^\["')
THEN Spanner_Value
ELSE ARRAY_TO_STRING(Spanner_Value, ',')
END
, ',')
) AS v
) AS Spanner_Value_Ordered

FROM your_table;
