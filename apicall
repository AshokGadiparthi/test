CREATE TABLE `your_project_id.your_dataset.rca_summary` (
  dag_id STRING,                         -- DAG identifier
  task_id STRING,                        -- Task identifier
  execution_date TIMESTAMP,              -- Airflow execution date
  start_date TIMESTAMP,                  -- Task start time
  end_date TIMESTAMP,                    -- Task end time
  duration_seconds FLOAT64,              -- Duration in seconds
  state STRING,                          -- Task state (success, failed, etc.)
  try_number INT64,                      -- Number of attempts
  operator STRING,                       -- Operator used (e.g. PythonOperator)
  owner STRING,                          -- DAG owner
  upstream_dag STRING,                   -- Upstream DAG name (if detected)
  upstream_task STRING,                  -- Upstream task causing failure
  upstream_status STRING,                -- Upstream task state
  failure_reason STRING,                 -- Extracted failure message or exception
  root_cause STRING,                     -- Inferred root cause (data issue, dependency, infra, etc.)
  rca_analysis STRING,                   -- Summary or RCA notes generated by code
  rca_category STRING,                   -- High-level RCA category (e.g., 'Data Delay', 'API Failure')
  triggered_by STRING,                   -- System or pipeline that triggered DAG
  env STRING,                            -- Environment (dev/stg/prod)
  rca_generated_at TIMESTAMP,            -- Time RCA was generated
  alert_sent BOOL,                       -- Whether an alert/email was sent
  alert_channel STRING,                  -- Channel (e.g., Teams, PagerDuty, etc.)
  dag_run_id STRING,                     -- Airflow DAG Run ID
  run_type STRING,                       -- Scheduled/Manual/External
  notes STRING                           -- Free-form remarks
)
PARTITION BY DATE(rca_generated_at)
CLUSTER BY dag_id, state;
